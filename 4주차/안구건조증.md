# 프로세스와 스레드의 차이

## 프로그램과 프로세스
### 프로그램(Program)
정의: 실행 가능한 파일의 집합. 예를 들어, 윈도우의 *.exe 파일이나 Mac의 *.dmg 파일 등이 이에 해당한다.

특징: 아직 실행되지 않은 정적인 상태이다. 즉, 코드 덩어리에 불과하다.

## 프로세스(Process)
정의: 실행 중인 프로그램이다. 프로그램이 실행되면 프로세스가 된다.

특징: 프로그램이 동적으로 변하여 작업 중인 상태를 의미한다.
운영 체제가 프로그램을 실행할 때, 해당 프로그램의 코드, 데이터, 힙, 스택 등을 메모리에 할당하고 이를 프로세스라고 한다.
프로세스는 자체적인 주소 공간, 메모리, 글로벌 변수 등을 가지며, 독립적으로 실행된다.

## 프로세스 제어 블록(Process Control Block, PCB)
프로세스 제어 블록은 프로세스가 생성될 때마다 생성되는 운영체제의 자료구조이다.

PCB는 프로세스의 상태 정보를 저장하고 있다. 프로세스의 상태 정보란 프로세스 식별자, 프로세스 상태, 프로그램 카운터, 스케줄링 정보, 메모리 관리 정보, 입출력 상태 정보 등을 말한다.
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FtIPDr%2FbtqUnKRlmuB%2FDJIs4kFAwQE5ySaiJz25Kk%2Fimg.png)
(사진 출처 : https://yoongrammer.tistory.com/52)

* 프로세스 식별자(Process ID, PID): 각 프로세스에 고유한 식별자를 제공한다. 이를 통해 운영 체제는 서로 다른 프로세스를 구별할 수 있다.


* 프로세스 상태: 프로세스의 현재 상태를 나타낸다. 예를 들어, 실행 중(running), 준비(ready), 대기(waiting) 등의 상태가 있다.


* 프로그램 카운터(Program Counter, PC): 프로세스가 다음에 실행할 명령어의 주소를 가리킨다. 이를 통해 프로세스가 중단되었다가 다시 시작될 때, 어디서부터 실행을 재개해야 하는지 알 수 있다.


* 레지스터 세트: CPU 레지스터의 현재 값들을 저장한다. 이 정보는 프로세스가 중지되었을 때의 정확한 상태를 나중에 복구하는 데 필요하다.


* 프로세스 스케줄링 정보: 프로세스의 우선순위, 스케줄링 큐에 대한 정보 등 스케줄링과 관련된 정보를 포함한다.


* 메모리 관리 정보: 프로세스가 사용하는 메모리 영역에 대한 정보를 포함한다. 이는 프로세스의 주소 공간, 페이지 테이블 등을 포함할 수 있다.


* 입출력 상태 정보: 프로세스에 할당된 입출력 장치와 열린 파일 목록 등 프로세스의 입출력 관련 정보를 포함한다.


* 어카운팅 정보: 프로세스의 실행에 소요된 CPU 시간, 실제 사용 시간 등의 어카운팅 정보를 저장한다.

## 스레드(Thread)

### 프로세스의 한계
과거에는 프로그램을 실행할 때 실행 시작부터 실행 끝까지 프로세스 하나만을 사용해서 진행했다.
하지만 시간이 흐를수록 프로그램이 복잡해지고 프로세스 하나만을 사용해서 프로그램을 실행하기는 벅차게 되었고,
프로세스와는 다른 더 작은 실행 단위 개념이 필요하게 되었다. 이 개념이 바로 스레드다.

![](https://storage.googleapis.com/static.fastcampus.co.kr/prod/uploads/202208/034021-289/images-raejoonee-post-6f274681-dfa7-45eb-9121-2cc9f4b972a5-102.png)
(By I, Cburnett, CC BY-SA 3.0)

스레드는 프로세스와 다르게 스레드 간 메모리를 공유하며 작동한다. 
스레드끼리 프로세스의 자원을 공유하면서 프로세스 실행 흐름의 일부가 되는 것이다. 

스레드도 코드에 비유하자면 스레드는 코드 내에 선언된 함수들이 되고 따라서 main 함수 또한 일종의 스레드라고 볼 수 있게 되는 것이다.

## 프로세스와 스레드의 작동 방식

![](https://storage.googleapis.com/static.fastcampus.co.kr/prod/uploads/202208/034524-289/images-raejoonee-post-b7939911-f3e8-48ac-abb8-63d8a17d0444-103.png)
(이미지 출처: Heee's Development Blog)

스레드는 메모리를 서로 공유할 수 있다는 것에 대해 더 자세히 설명하자면, 프로세스가 할당받은 메모리 영역 내에서 Stack 형식으로 할당된 메모리 영역은 따로 할당받고, 
나머지 Code/Data/Heap 형식으로 할당된 메모리 영역을 공유한다. 
따라서 각각의 스레드는 별도의 스택을 가지고 있지만 힙 메모리는 서로 읽고 쓸 수 있게 된다.

![](https://storage.googleapis.com/static.fastcampus.co.kr/prod/uploads/202208/034603-289/images-raejoonee-post-b91490ed-c67b-407d-8fea-a8d6fdb22559-104.png)
(이미지 출처: Heee's Development Blog)

## 메모리 공유

만약 한 프로세스를 실행하다가 오류가 발생해서 프로세스가 강제로 종료된다면, 공유하고 있는 파일을 손상시키는 경우가 아니라면 아무런 영향을 주지 않는다.

그런데 스레드의 경우는 다르다. 스레드는 Code/Data/Heap 메모리 영역의 내용을 공유하기 때문에 어떤 스레드 하나에서 오류가 발생한다면 같은 프로세스 내의 다른 스레드 모두가 강제로 종료된다.

스레드를 코드(프로세스) 내에서의 함수(스레드)에 빗대어 표현해보면 이해하기 훨씬 쉬워진다.
코드 내 어떤 함수 하나에서 NPE 등의 오류가 발생했다고 치자. 이 오류가 어떤 함수에서 발생했든 간에 해당 코드는 다른 함수 모두에 대한 작업을 중단하고 프로세스 실행을 끝내버린다.

![](https://lh5.googleusercontent.com/HLsHvqVDwENZvVhLHFqiRLq3f8Pl6pJ-uQx9QZIoHwFuH-nEbWPX2_Y3migX_vnDM72hceCbSrU4lcTim7rNAvAfHmNym0lInw1HJBVg6bTTof6UqaAYm1q5VfPqNJAIjI9Uzmp0)
(사진 출처 : https://www.crocus.co.kr/1403)

이런 방식으로 메모리를 공유하는 이유는 다음과 같다.

1. 자원 공유
   * 각 스레드가 프로세스의 데이터와 자원에 직접 접근할 수 있게 해, 자원을 효율적으로 사용할 수 있게 한다.

2. 성능 향상
   * 스레드 간의 컨텍스트 스위칭은 프로세스 간 컨텍스트 스위칭보다 덜 자원을 소모하고 더 빠르다. 이는 스레드들이 메모리 및 기타 자원을 공유하기 때문이다. 

3. 응답성 향상 
   * 한 스레드가 긴 작업을 처리하고 있는 동안에도, 같은 프로세스 내의 다른 스레드가 사용자 상호작용과 같은 다른 작업을 계속 처리할 수 있다.

이러한 메모리 공유에는 단점도 있다.

예를 들어, 한 스레드에서 발생한 예외나 오류(예: Null Pointer Exception)가 전체 프로세스에 영향을 미칠 수 있다.

한 스레드에서 발생한 심각한 문제는 프로세스의 다른 스레드들에게도 영향을 미치며, 결국 전체 프로세스가 종료되는 결과를 가져온다.
이는 스레드 간의 긴밀한 연결성 때문에 발생하는 문제로, 멀티스레딩 환경에서는 이러한 상황을 관리하기 위한 추가적인 주의가 필요하다.