# 프로세스 동기화

## 공유자원, 경쟁상태, 임계영역?

- 공유자원(Shared Resource) : 시스템 안에서 각 프로세스, 스레드가 함께 접근할 수 있는 자원이나 변수를 말한다.
- 경쟁상태(Race condition) : 공유자원을 둘 이상의 프로세스 또는 스레드가 동시에 읽거나 쓰는 상황으로 접근 순서에 따라 예상되는 결과 값과 다른 결과가 나타날 수
  있는 상태를 말한다.
- 임계영역(Critical Section) : 둘 이상의 프로세스 또는 스레드가 공유자원에 접근하는 순서 등의 이유로 결과가 달라지는 코드 영역을 말한다. 임계영역은 한번에 둘
  이상의 프로세스나 스레드가 들어갈 수 없도록 설계된다.

> **정리**<br>
> 둘 이상의 프로세스 또는 스레드가 동시에 접근하는 자원을 `공유자원`,
> 타이밍에 따라 공유 자원의 결과 값이 달라지는 상황을 `경쟁상태`,
> 이러한 경쟁상태와 관련 있는 코드 영역을 `임계영역`이라 한다.

## 경쟁상태의 문제점

경쟁상태를 관리하는 것은 매우 중요하다. 경쟁상태를 잘 해결하지 못할 경우 데이터 정합성, 데이터 무결성을 지키지 못할 수 있다.

- 데이터 정합성 : 예상되는 데이터의 값과 다른 것을 의미한다.
- 데이터 무결성 : 데이터의 어떠한 규칙을 위반하면 안되는 것을 의미한다.

## 경쟁상태 해결방법

경쟁상태를 해결하는 대표적인 방법으로 뮤텍스, 세마포어, 모니터 3가지가 있다.
이들은 상호배제, 한정대기, 진행 이 3가지 조건을 만족시키며 경쟁 상태를 해결한다.

- 상호배제(Mutual Exclusion) : 한 프로세스가 임계영역에 들어갔다면 다른 프로세스는 들어갈 수 없다.
- 한정대기(Bounded Waiting) : 특정 프로세스가 임계영역 진입을 요청한 후 해당 요청이 승인되기 전까지 다른 프로레스가 임계영역에 진입하는 횟수를 제한한다.
  이를 통해 특정 프로세스가 영원히 임계영역 못하게 되는 상황을 방지한다.
- 진행(Progress) : 만약 어떠한 프로세스도 임계영역을 사용하지 않을 경우 어떠한 프로세스도 임계영역에 들어갈 수 있다. 이때 프로세스끼리 서로 방해하지 않는다.

### 뮤텍스

뮤텍스는 공유자원 접근 시 `lock()`을 통해 잠금설정하고, 모두 사용한 후에 `unlock()`을 통해 잠금해제를 하는 객체 lock을 기반으로 경쟁상태를 해결하는 기법이다.
잠금이 설정되면 프로레스나 스레드는 잠긴 코드영역에 접근할 수 없으므로 한번에 하나의 프로세스만이 임계영역에 있을 수 있다.

### 세마포어

세마포어는 일반화된 뮤텍스를 말한다. 간단한 정수 S와 두가지 함수 `wait()` 및 `signal()`로 공유자원에 대한 접근을 처리하는 기법이다.
이를 통해 여러 프로세스가 동시에 임계영역에 접근할 수 있다.

- S는 현재 사용가능한 공유자원의 수
- wait()는 S를 1씩 감소시킨다. 감소시키다가 S가 음수가 될 경우 사용할 수 있는 공유자원이 없기 때문에 프로세스는 차단되며 대기열에 프로세스를 집어 넣는다.
- signal()은 S를 1씩 증가시킨다. 공유자원을 프로세스가 다 쓴 상태를 말하며, 만약 S가 0 이하일 경우 대기열에 있던 프로세스가 동작하게 된다.

세마포어는 바이너리 세마포어와 카운팅 세마포어로 나뉜다.

- 바이너리 세마포어 : 바이너리 세마포어는 0과 1의 두가지 값만 가질 수 있는 세마포어이다. 구현의 유사성으로 인해 뮤텍스는 바이너리 세마포어라고 할 수 있지만 
  엄밀히 말하면 뮤텍스는 잠금을 기반으로 상호배제가 일어나는 '잠금 메커니즘'을 사용하고, 세마포어는 신호를 기반으로 상호 배제가 일어나는 '신호 메커니즘'을 사용한다는 점이 다르다.
- 카운팅 세마포어 : 여러 개의 값을 가질 수 있는 세마포어이다. 공유 자원을 사용하면 세마포어가 감소, 방출하면 세마포어가 증가한다.

### 모니터

모니터(monitor)는 둘 이상의 스레드나 프로세스가 공유 자원에 안전하게 접근할 수 있도록 공유 자원을 숨기고, 해당 접근에 대해 인터페이스만 제공하는 객체이다.
이를 통해 공유 자원에 대한 작업들을 순차적으로 처리한다.

## 교착상태

교착상태(deadlock)는 두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태를 말한다. 
이 과정에서 각 프로세스는 서로가 원하는 자원을 유지한 채 다른 프로세스의 자원을 얻기만을 기다리는 것이다.
ex) P1이 P2가 점유하고 있는 자원을 요구 ↔️ P2도 P1이 점유하고 있는 자원을 요구
