# 멀티 스레드

## 멀티 스레드란?
멀티 스레드는 하나의 프로세스에서 여러 개의 스레드가 동시에 작업을 수행하는 것을 말한다. 멀티 스레드는 프로세스 내의 주소 공간이나 자원을 공유할 수 있기 때문에, 프로세스 간의 통신 방법에 비해 더 빠르게 작업을 수행할 수 있다.
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbvfndW%2FbtrjAeFcoaB%2F7amMfccrT6JOdWyn4ldaV1%2Fimg.png)
예) 웹 애플리케이션에서는 사용자가 서버 데이터베이스에 자료를 요청하는 동안 브라우저의 다른 기능을 이용할 수 있다. 이는 대표적인 멀티 스레딩이다.

사진 출처 : https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-multi-process-multi-thread#multi_thread

## 멀티 스레드의 장점
1. 스레드는 프로세스보다 가볍다.
   * 프로세스는 각각 독립된 메모리 영역을 할당받지만, 스레드는 프로세스 내의 메모리를 공유하기 때문에 프로세스보다 가볍다. 
   * 코드, 데이터, 스택 영역을 제외한 나머지 자원은 서로 공유하기 때문에 기본적으로 내장된 데이터 용량이 프로세스보다 작다.

2. 자원의 효율성
    * 멀티 스레드는 하나의 프로세스 내에서 여러 개의 스레드가 생성된 것이기 때문에, 힙 영역과 같은 자원을 공유할 수 있다. 이는 프로세스 간의 통신 방법에 비해 더 빠르게 작업을 수행할 수 있다.

3. Context Switching 비용 감소
   * Context Switching : CPU가 어떤 프로세스에서 다른 프로세스로 전환하는 것
   * Context Switching 비용 : 스위칭할 때마다 CPU 캐시에 있는 데이터를 모두 초기화하고 새로운 프로세스의 데이터를 캐시에 불러오는 데 드는 비용
   * 멀티 스레드는 Context Switching시 스레드 간에 공유하는 자원을 제외한 스레드 정보(데이터, 스택 등)만 교체하면 되므로 프로세스 간의 Context Switching 비용보다 적게 든다.

4. 응답 시간 단축
   * 위 3가지의 이유로, 멀티 스레드는 스레드 간의 통신이나 자원 공유가 용이하고, 프로세스보다 가벼우므로 Context Switching 오버헤드도 작다.
   그러므로 응답 시간을 단축시킬 수 있다.

## 멀티 스레드의 단점
1. 안정성 문제
   * 멀티 스레드는 프로세스 내의 자원을 공유하기 때문에, 하나의 스레드가 데이터를 변경하면 다른 스레드에 영향을 미칠 수 있다. 이는 동기화 문제를 발생시킬 수 있다.
   ![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FL5gYp%2Fbtr6eUGAI4R%2F9UC9f5ZWqb9TakHZWmCc30%2Fimg.png)
     사진 출처 : https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-multi-process-multi-thread#multi_thread

2. 동기화로 인한 성능 저하
    * 안정성 문제를 해결하기 위해 스레드간 동기화는 데이터 접근을 제어하기 위한 필수 기술이다.
    * 동기화는 여러 스레드들의 자원에 대한 접근을 순차적으로 통제하는 것이다. 이는 병목 현상을 일으키고, 성능 저하를 일으킬 수 있다.
    * 병목 현상 : 병목 현상은 시스템의 성능을 제한하는 요소를 가리킨다. 이는 프로세스나 스레드가 실행되는 동안 다른 프로세스나 스레드가 대기하는 현상

3. 데드락(교착 상태)
   * 데드락 : 두 개 이상의 프로세스나 스레드가 서로 상대방의 작업이 끝나기만을 기다리고 있기 때문에 결과적으로 아무것도 완료되지 못하는 상태
   * 이를 방지하기 위한 상호배제(Mutual Exclusion), 점유와 대기(Hold and Wait), 비선점(No Preemption), 순환 대기(Circular Wait) 등의 알고리즘을 통해 극복해야 함.

4. 어려운 디버깅
    * 멀티 스레드는 여러 스레드가 동시에 실행되기 때문에, 디버깅이 어렵다. 특히 동기화 문제로 인한 버그는 찾기 어렵다.


## 멀티 스레드 vs 멀티 프로세스
멀티 스레드와 멀티 프로세스는 각각의 장단점이 있으며, 상황에 따라 적절한 방법을 선택해야 한다.

### 멀티 스레드에 사용하면 좋은 예
* 웹 서버 : 동시에 많은 요청을 처리해야 한다. 각 요청은 독립적이며 크게 리소스를 소모하지 않지만, 동시성을 관리해야 할 필요가 있다.
  이 때 멀티 스레딩을 사용하면 각 스레드가 독립적인 요청을 처리할 수 있기 때문에 효율적이다.
* GUI 어플리케이션 : 사용자 인터페이스를 가진 응용 프로그램은 사용자 입력, 화면 그리기, 네트워크 통신 등 다양한 작업을 동시에 처리해야 한다. 멀티 스레딩을 사용하면, UI를 응답성 있게 유지하면서 배경 작업(예: 파일 다운로드)을 처리할 수 있다.

### 멀티 프로세스에 사용하면 좋은 예
* 웹 브라우저: 현대의 웹 브라우저는 멀티 프로세스 아키텍처를 사용하여 각 탭을 별도의 프로세스로 실행한다. 이는 한 탭에서 발생하는 문제가 전체 브라우저를 중단시키지 않도록 하기 위함이다. 각 탭이 독립적인 프로세스로 실행됨으로써, 하나의 탭이 충돌하거나 메모리 누수가 발생해도 다른 탭에 영향을 미치지 않고, 해당 탭만 다시 시작할 수 있다.

### 상황에 따른 선택?
* 메모리 사용량과 컨텍스트 전환 비용이 중요한 경우: 멀티 스레딩이 유리하다. 스레드는 같은 메모리 공간을 공유하므로 메모리 사용량이 적고, 컨텍스트 전환 비용도 프로세스에 비해 낮다.
* 안정성과 격리가 중요한 경우: 멀티 프로세스가 유리하다. 각 프로세스는 독립적인 메모리 공간을 가지므로, 한 프로세스의 실패가 다른 프로세스에 영향을 미치지 않는다.
* 리소스 공유와 통신 비용이 중요한 경우: 멀티 스레딩은 프로세스 내에서 리소스 공유가 자연스럽고, 스레드 간 통신 비용이 낮다. 반면, 멀티 프로세스는 IPC(Inter-Process Communication) 메커니즘을 통해 통신해야 하므로 비용이 더 높다.