# 전송 계층의 프로토콜
TCP와 UDP는 OSI 7계층 중 4계층인 **전송 계층(Transport Layer)** 에서 동작하는 프로토콜입니다.

4계층은 프로세스 간(process-to-process)의 전송 기술을 다룹니다. 2계층에서는 노드, 3계층에서는 호스트(컴퓨터)를 구분하며, 4계층에서는 호스트 내에서 실행 중인 프로세스를 식별하게 됩니다.

호스트 내에서 다양한 프로세스가 동시에 실행 중일 수 있기 때문에, 프로세스를 식별하기 위해서는 고유한 **포트(Port)** 번호를 부여합니다.

쉽게 비유하자면 IP 주소는 아파트 주소와 같고, 포트 번호는 집 호수와 같다고 볼 수 있으며, 일반적으로 이 둘을 합쳐 **소켓 주소(Socket Address)** 라는 이름으로 부릅니다.

# 연결 지향 방식 & 비연결 방식
이렇게 프로세스를 식별할 수 있는 주소를 이용하면 프로세스 간 통신이 가능합니다.<br>
이때 두가지 방식을 이용해 통신이 가능한데, `연결 지향(Connection-Oriented)` 방식과 `비연결(Connectionless Protocol)` 방식이 있습니다.

`연결 지향 방식`은 송신자와 수신자가 1:1로 연결 상태를 유지하면서 통신하는 것을 말합니다.<br>
이 방식은 데이터를 보내기 전에는 연결 설정(Connection Establish) 단계를, 보낸 후에는 연결 종료(Connection Close) 단계를 거쳐야만 합니다.<br>
이는 데이터를 교환하는 데 있어 안전하고 믿을 수 있는 환경을 제공하지만, 과정이 복잡하다는 단점이 있습니다.

이러한 연결 지향 방식의 대표적인 예가 바로 `TCP`입니다.

반면, `비연결 방식`은 송신자와 수신자가 연결 상태를 유지하지 않고 통신하는 것을 말합니다.<br>
이는 데이터 송신자는 수신자가 제대로 받았는지 여부와 상관없이 일방적으로 데이터를 뿌리고 끝냄을 의미합니다.

송신자 입장에서는 단순한 방법이지만, 수신자 입장에서는 데이터가 정확한지도 알 수 없고, 데이터의 순서도 보장할 수 없으며, 심지어 받지 못하는 경우도 일어난다는 단점이 있습니다.

이러한 비연결 방식의 대표적인 예가 바로 `UDP`입니다.

이렇게 `TCP`와 `UDP`는 지향하는 방식이 다릅니다.

# UDP
![UDP 헤더](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbCu34D%2FbtsDsXrMIJP%2F6nc6RMgykAhDPVQFkuZmKk%2Fimg.png)

UDP는 사용자 데이터그램 프로토콜(User Datagram Protocol)의 약자입니다.<br>
데이터들이 독립적인 패킷으로 전송되며 UDP 헤더에는 순서와 관련된 정보가 없기 때문에 수신 측에서 알아서 순서를 재조립해야 하며, 패킷이 중간에 손실되어도, 프로토콜 자체적으로 손실을 알아낼 방법이 없습니다.

이는 앞서 말했듯이, UDP가 비연결 방식의 프로토콜이기 때문입니다. 이러한 UDP의 특징 때문에 실시간성이 중요하거나 데이터의 신뢰성이 굳이 보장되지 않아도 되는 곳에 사용됩니다.


# TCP
![TCP 헤더](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcquADH%2FbtsDrE0aZNk%2FCjNhJejbPSj50H3ReUotG0%2Fimg.png)

TCP는 전송 제어 프로토콜(Transmission Control Protocol)의 약자로, 연결 지향 방식임과 동시에 스트림 기반(Stream-Oriented) 방식으로도 불립니다.<br>
이는 TCP 통신이 마치 가상의 연결선을 이용해 두 컴퓨터가 연속적으로 데이터 교환이 가능하게 하는 것처럼 보이기 때문입니다.


TCP는 프로세스 간의 통신에서 데이터를 **안정적(Reliable)** 으로 주고 받을 수 있는 프로토콜입니다.

TCP 헤더는 UDP 헤더에 비해 담긴 데이터의 양이 상당히 무거운 것을 알 수 있습니다.
헤더는 목적지 정보를 포함해 시퀀스 넘버(Sequence number), 승인 넘버(Acknowledgment number), 제어 필드(Contorl Fields)등 많은 데이터가 담겨 있습니다.

TCP의 핵심적인 3가지 특징은 다음과 같습니다.

### 1️⃣ 핸드셰이크
TCP는 연결 지향 방식이기 때문에 데이터 교환 전후 연결 설정/해제 과정을 거치는데 이를 **핸드셰이크(HandShake)** 과정이라 합니다.

**연결 설정 단계**에서는 3단계(3-way)로 핸드셰이크 과정을 진행합니다.

이 단계에서는 연결 요청을 나타내는 `SYN` 플래그를 클라이언트와 서버가 교환하는 것에 의의를 둡니다.
그리고 데이터를 잘 받았다는 사실을 알리기 위해 `ACK` 넘버를 함께 전송하는데, 각자 상대방으로부터 받은 시퀀스 번호에 1을 더해 보냅니다.

연결이 설정되면 **데이터 교환 과정**을 거칩니다. 이 단계는 핸드셰이크처럼 엄밀하게 순서가 정해져 있지 않고, 각자 내부적으로 송신과 수신 상태가 담긴 패킷을 보냅니다.

이 과정에서도 데이터를 잘 받았다는 `ACK` 넘버를 상대방에게 보내는데, 데이터 교환 과정에서는 상대방에게서 마지막으로 받은 시퀀스 넘버에 수신한 데이터(세그먼트)의 바이트 수에 1을 더해 보냅니다.
`TCP`는 이 값을 이용해 통신 과정 중 어떤 부분에서 손실이 났는지 파악할 수 있는 것이죠!

**연결 종료 단계**에서는 4단계(4-way)의 핸드셰이크 과정을 진행합니다.

일방적으로 연결을 종료하게 되면, 상대방은 연결이 끊어졌는지 지속되고 있는지를 알 방법이 없으므로 종료 과정은 반드시 필요합니다.
종료 단계에서는 `FIN` 플래그를 교환하는 것에 의의를 두며, 연결 설정 단계처럼 상대방에게서 받은 시퀀스 번호에 1을 더해 `ACK` 넘버를 전송합니다.

### 2️⃣ 신뢰성과 흐름 제어
**신뢰성**과 **흐름 제어** 기능은 TCP의 중요한 특징입니다.
데이터가 중간에 소실되거나 회선 교환에 실패했다 하더라도, 이를 알아차리고 복구하기 위해 다양한 해결책을 제시하는 것이 특징입니다.

신뢰성은 핸드셰이크 과정에서 이야기 했지만, 내가 보낸 데이터에 대한 `ACK`가 오지 않는다면, 이는 중간에 패킷이 손실된 경우로 간주할 수 있습니다.
이처럼 중간에 손실이 발생하면 상대방으로부터 이미 받은 `ACK`를 중복해서 받게 됩니다. 
TCP는 이를 이용해 손실이 난 부분을 재전송하거나, 손실이 발생한 부분부터 다시 보내는 방식을 취합니다.

흐름 제어는 흐름제어는 데이터를 송신하는 곳과 수신하는 곳의 데이터 처리 속도를 조절하여 수신자의 버퍼 오버플로우를 방지하는 것입니다.
예를 들어 송신하는 곳에서 감당이 안되게 데이터를 빠르게 많이 보내면 수신자에게 문제가 발생하기 때문입니다.

### 3️⃣ 혼잡 제어
혼잡 제어는 네트워크 내의 패킷 수 과도하게 증가하지 않도록 방지하는 것입니다.
만약 정보의 소통량의 과도하면 송신 속도를 조절해 혼잡 붕괴 현상이 일어나는 것을 막습니다.

# TCP & UDP
![TCP vs UDP](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FyhP4R%2FbtskhaWJdn7%2FqJypbu4t4jVbAhXXQlaPD1%2Fimg.png)

### TCP 특징
- 연결 지향 방식으로 통신한다.
- 3-way 핸드셰이크 과정을 통해 연결을 설정하고, 4-way 핸드셰이크 과정을 통해 연결을 해제한다. 
- 흐름 제어 및 혼잡 제어 기능이 있다.
- 높은 신뢰성을 보장한다.
- UDP보다 속도가 느리다.

### UDP 특징
- 비연결 방식으로 통신한다.
- 정보를 주고 받을 때 수신 여부를 확인하지 않는다.
- UDP 헤더의 체크섬을 통해 최소한의 오류만 검출한다.
- 신뢰성이 낮다.
- TCP보다 속도가 빠르다.
