# TDD란 무엇이고, 어떤 특징이 있을까?

## TDD : Test-Driven Development

### Driven-Development
> #### 소프트웨어 개발 방법론
- 소프트웨어 개발방법론은 소프트웨어를 어떻게 만들지에 대해 중점을 두고 있다. 따라서 개발 방법론에는
1) 단계별 산출물
2) 산출물은 누가 어떤 순서로 어떻게 만들어야 하는지
3) 어떤 도구를 사용해야 하는지 구체적으로 정의한다.
- 우리가 아는 개발 방법론은 폭포수 모델(Waterfall Model), 애자일(Agile Methodologies), 린(Lean), 스파이럴(Spiral), 라디칼(RAD), 프로토타이핑(Prototyping)이 있다.
- 이중 TDD는 애자일 방법 중 하나로, 애자일은 반복적이고 점진적인 개발 방법, 유연성과 빠른 적응력을 갖춘다는 특징이 있다.

### TDD
> 소프트웨어 개발 방법론 중 하나로 ‘테스트 주도 개발’을 의미합니다.
- 코드를 작성하기 이전에 '테스트 케이스를' 작성하고 테스트를 통과하기 위한 그에 맞는 기능을 작성한다. 테스트 중에 실패한 코드에 대해서는 수정해 나아가면서 '반복적인 테스트'를 통한 개발을 하는 작업을 의미한다.
- 매우 짧은 개발 사이클의 반복을 통해, 프로세스를 진행한다.
  ![](https://velog.velcdn.com/images/oyoungsun/post/f9c599c8-a788-4987-8740-41d8618260fc/image.png)
#### Write a failling test
- 새로운 기능을 추가하기 전 테스트를 먼저 작성한다. 테스트는 해당 기능의 요구사항과 명세를 통해 정의된다.
#### Run all tests and see if new one fails
- 어떤 새로운 기능을 추가하면 잘 작동하던 기능이 제대로 작동하지 않는 경우가 발생할 수 있다. 더 위험한 경우는 개발자가 이를 미처 인지하지 못하는 경우이다. 이러한 경우를 방지하기 위해 테스트 코드를 작성하고, 새로운 기능과 기존의 기능이 모두 잘 동작하는지 확인한다.
#### Refactor code
'좋은 코드'를 작성하기위해
- Coding convention
- 네이밍 규칙, 메소드명, 변수명, 클래스명에 일관성 부여
- 확장성, 비즈니스 로직 고려.
- 예외처리 고려하기
  들을 담다보면 코드량이 방대해져 리팩토링을 하게 된다. 이 때 테스트 주도 개발을 통해 개발을 해왔다면, 테스트 코드가 그 중심을 잡아줄 수 있다. 함수를 작은 모듈로 분할하는 과정에서 테스트를 통해 모듈들이 정상 동작을 함을 확인할 수 있다.
  결과적으로 리팩토링 속도도 빨라지고 코드의 퀄리티 올라가게 된다.
  ➡️ 코드 퀄리티 부분을 조금 상세히 들어가보면, **보다 객체지향적이고 확장 가능이 용이한 코드, 재설계의 시간을 단축시킬 수 있는 코드, 디버깅 시간이 단축되는 코드**가 TDD 와 함께 탄생하는 것이다.

### TDD 관련 궁금증 정리
🐥 테스트 케이스
- 특정 기능 또는 시나리오를 테스트하기 위한 지침이 포함된 문서. 테스트를 수행과 관련된, **테스트의 목적, 입력 데이터, 예상 결과 등을 명확하게 정의**한다.

🐥 테스트 케이스를 작성하는 자체가 TDD를 의미하는 것일까?
- 테스트는 코드를 검증하기 위해 사용하는 것.
- TDD : 테스트 케이스를 우선 작성하고 그 다음 코드를 작성
- not TDD : 코드를 우선 작성 후 그 다음 테스트 작성 후 검증하는 것
  => TDD : 요구사항의 변경 시에도, 테스트가 먼저 작성되어 _**"Testable"**_ 가능하다
```
* Testable Code란? 테스트 하기 쉽게 작성된 코드. 
즉, 모듈의 크기(역할의 크기)가 세분화, 명확하게 정의되어있음. 유지보수와 확장에 용이함
```
### TDD의 장점

1. 품질 향상
- 개발자는 코드의 동작을 확실히 이해하고 테스트 케이스를 통해 코드의 정확성을 검증한다. 코드가 견고하고 안정적이 된다.
2. 리팩토링 지원
- TDD는 코드를 작은 단위로 분리하고 테스트 가능한 형태로 작성하도록 한다. 코드의 확장성이 높아진다.

3. 빠른 피드백
   **- 작은 단위의 테스트를 빠르게 실행하고 결과를 확인한다. 버그를 빠르게 발견하고 수정할 수 있으며, 코드 변경에 대한 피드백을 신속하게 받을 수 있다.**

4. 협업 강화
- TDD는 테스트 코드가 문서화되므로, 다른 개발자들과의 협업을 용이하게 한다.

> #### 🐥테스트 단위
피라미드에서 아래로 갈수록 크기는 작아지고, 필요한 개수는 커진다.
![](https://velog.velcdn.com/images/oyoungsun/post/181030ba-64e6-4160-a25d-ca05b02210ca/image.png)
유닛 테스트: 함수 하나하나와 같이 코드의 작은 부분을 테스트하는 것
통합 테스트: 서로 다른 시스템들의 상호작용이 잘 이루어 지는지 테스트하는 것
기능 테스트: 사용자와 어플리케이션의 상호작용이 원활하게 이루어지는지 테스트하는 것
출처 : https://cjwoov.tistory.com/9

### TDD 수행 과정
#### 1. Write Test : 테스트 코드 작성
> - 구현하려는 기능이나 동작을 검증할 테스트 코드를 작성
    - 해당 단계에서 원하는 동작이 ‘실패하는 테스트 케이스’를 작성

#### 2. Test Fails : 실패하는 테스트 실행
> - 작성한 테스트를 실행하여 기대한 대로 동작하지 않는 것을 확인.
    - 이때는 실패하는 테스트가 예상대로 동작하는 것이다.
    (아직 코드가 없기때문)

#### 3. Write Code: 코드 작성
> - 실패하는 테스트를 통과할 수 있는 최소한의 코드를 작성.
    - 이 단계에서는 테스트를 통과하는 것이 목표이다.

#### 4. Test Passes: 테스트 통과
> - 작성한 코드가 테스트를 통과하는지 확인.
    - 테스트가 성공적으로 통과되면 기능이 제대로 구현된 것으로 간주
    _*해당 단계에서는 반드시 테스트가 통과되어야 한다._

#### 5. Refactor: 리펙토링
> - 이전 과정에서 테스트를 통과한 코드를 개선하고 중복을 제거하며 코드의 가독성을 높이는 등의 작업을 수행
    - 기능의 동작에는 영향을 주지 않으며, 코드의 품질을 개선하는 단계이다.
    _-  예를 들어, 게임을 개발하면서 stage 3를 테스트 할 때 항상 stage 1, stage 2를 클리어한 뒤 테스트를 해야한다. -> 테스트 비용이 증가한다. 
    - 어떻게 하면 테스트 비용을 낮출 수 있을까를 고민한다. -> 파라미터로 stage2가 완료된 상황을 주입해 stage 3로 갈 수 있도록 만든다.
    - Back Door 접근 법 : 테스트할 때 파라미터를 적용하여 본인이 원하는 시스템의 시작점으로 가게 하는 것.즉, 중복적으로 하는 노력들을 자동화하도록 업그레이드하면 발전할 수 있다
    출처: https://wooaoe.tistory.com/33 [개발개발 울었다:티스토리]_


➡️ 결론적으로, TDD에서 가장 중요한 원칙은 `최소한의 코드`를 작성하여 `최소 단위 테스트를 통과`시켜 `점진적으로 코드`를 확장해 나아가는 것을 추구한다.

### Java에서는 어떻게 TDD를 적용할까 : Junit

JUnit은 현재 전 세계적으로 가장 널리 사용되는 'Java 단위 테스트 프레임워크' 이다.

### 💡 TDD의 한계

🐥 코드 생산성 문제
- 전체적인 코드량의 증가가 발생한다. `코드 퀄리티 < 생산성(비용)`이 요구되는 시점에서 TDD 는 큰 걸림돌이 될 수 있다.

🐥 테스트 코드 작성이 어려움
- 어떠한 부분을 테스트해야할 지, 어떻게 테스트해야할 지, 여러 테스트 프레임워크 중 어떤 것이 우리의 서비스와 맞는지 등 여러 부분들에 대한 **학습**이 필요하고 익숙해지는데 시간이 소요되는 진입장벽이 존재한다.

🐥 모든 상황에 대해서 테스트 코드를 작성이 어려움
- 생각지도 못한 예외 케이스가 존재할 수 있다. 또, 복잡한 시나리오와 UI, 성능 테스트 등은 TDD가 어렵다.
- 만약 테스트를 반드시 해봐야 하는 부분에 있어서 테스트 코드를 작성하는데 어려움이 발생한다면? 이러한 상황에서 주객이 전도하는 상황이 발생할 수 있다. **분명 실제 코드가 더 중심이 되어야 하는데 테스트를 위해서 코드의 구조를 바꿔야 하나하는 고민이 생긴다.** 또한 발생할 수 있는 상황에 대한 테스트 코드를 작성하기 위해 배보다 배꼽이 더 커지는 경우가 허다하다. 실제 구현 코드보다 방대해진 코드를 관리하는 것도 쉽지만은 않은 일이 된 것이다.

> 모든 코드에 대해서 테스트 코드를 작성할 수 없으며 작성할 필요도 없다. 또한 테스트 코드를 작성한다고 해서 버그가 발생하지 않는 것도 아니다. 애초에 TDD 는 100% coverage 와 100% 무결성을 주장하지 않았다.


## BDD(Behavior Driven Development)
> - 소프트웨어 개발론 중 하나로 ‘행동 주도’ 개발 방법론을 의미합니다.
- TDD에서 파생된 개발방법론으로 TDD에서 기능 중심의 '테스트케이스'를 작성하는데 한계를 극복하기 위해 등장했다.
- BDD에서는 ‘사용자의 행위’를 기반으로 ‘사용자 시나리오’를 구성하여 ‘테스트 케이스’를 작성하고 결과 검증을 진행하는 방식입니다.
- 즉, **‘사용자의 행위**’를 정의하고 행위에 따라 개발해 나아가는 방식을 의미합니다. 여기서 ‘사용자의 행위’는 기획자가 작성한 ‘요구사항’이나 ‘기획서’에 적혀 있는 내용 자체를 의미합니다.

### 테스트 시나리오 작성: Given, When, Then

- 개발자가 작성하는 시나리오로 원하는 기능이 어떻게 동작해야 하는지를 명세하는 것을 의미한다.
> 1. Given : 주어진 환경
- ‘사용자 행위’를 수행하기 위해 주어진 ‘환경’에 대해 서술합니다.
- 해당 단계에서는 시스템이나 애플리케이션의 초기 상태, 환경, 입력 등에 대해 서술합니다.
> 2. When : 행위
- 실제 사용자 행위에 대해서 서술합니다.
- 해당 단계에서는 시스템이나 애플리케이션 내에 발생하는 특정 조건이나 이벤트들에 대해 서술합니다.
> 3. Then : 기대결과
- 행위에 따른 기대결과를 서술합니다.
- 해당 단계에서는 예상되는 동작이 실제로 발생하는지 확인하고 기대한 결과가 나오는지에 대한 검증을 수행하여 서술합니다.
  ![](https://velog.velcdn.com/images/oyoungsun/post/10955425-2188-42c4-a068-6eb37dd9c141/image.png)
  ![](https://velog.velcdn.com/images/oyoungsun/post/29c15dd1-f9ba-4723-b9ee-62ea5017e0cc/image.png)

- BDD는 테스트 시나리오 그 자체가 기획서와 동기화 된다.

### TDD와 BDD의 차이점

➡️ TDD의 테스트 케이스

- ‘기능’을 확인하기 위한 목적으로 작성
  ex) add(1,1)이 2인지 확인

➡️ BDD의 테스트 케이스

- 시나리오를 주체로 한 ‘행위’를 확인하기 위한 관점에서 작성을 합니다.
  ex) 사용자가 "="를 눌렀을 때, '2'가 화면에 표시되는지 확인

![](https://velog.velcdn.com/images/oyoungsun/post/ae684de7-50a7-41c9-b3b6-b9ad02eac0d5/image.png)

TDD 관점에서 확인하기 어려운 유저관점에서의 시나리오를 BDD로 확인할 수 있고, 시나리오에서 사용되는 각 모듈의 기능 검증을 TDD를 통해 검증할때, 기대하는 Test Coverage 를 만족 가능!
**즉, TDD, BDD 하나만 사용하는 것이 아니라 상호 보완적으로 함께 사용하는 것이 보다 좋은 코드를 짜기 좋다**

![](https://velog.velcdn.com/images/oyoungsun/post/9e8a3595-ce37-47a2-a93c-3f2967376451/image.png)
> BDD, TDD 동작 사이클
- BDD가 수행되기 위해서는 TDD 사이클이 함께 돌아가야 한다.

### BDD 장점
코드를 작성중에 기획, 요구사항이 변경되는 경우, 기존 코드 수정이 커지는 리스크가 있음. (심지어 배포 후에도)
BDD는 이러한 기획 누락을 발견하게 해주는 장점이 있다. (코드 작성전이라 비용 리스크가 적음)

참고자료
- [[개발방법론] TDD, BDD 이해하기-1 : 정의 및 수행과정](https://adjh54.tistory.com/305)
- [kotest가 있다면 TDD 묻고 BDD로 가!](https://tv.kakao.com/channel/3693125/cliplink/414004682)
- https://hanamon.kr/tdd%EB%9E%80-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C/